<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <style>
    path {
      fill: rgba(0,0,0,0.2);
      stroke: rgba(0,0,0,0.5);
    }

    .graticule {
      fill: none;
      stroke: #ccc;
      stroke-width: .5px;
    }

    .foreground {
      fill: none;
      stroke: #333;
      stroke-width: 1.5px;
    }
  </style>
</head>

<body>
  <svg width="960" height="600"></svg>
  <script>
    const width = 960
    const height = 600
    const svg = d3.select("svg")
    const myProjection = d3.geoMercator()
    const path = d3.geoPath().projection(myProjection)
    const graticule = d3.geoGraticule()
    d3.json("calgary_topo.json", drawMap)

    function drawMap(err, calgary) {
      if (err) throw err


      svg.append("path")
        .datum(graticule.outline)
        .attr("class", "foreground")
        .attr("d", path)

      let communities = topojson.feature(calgary, calgary.objects.collection)
      let neighbors = topojson.neighbors(calgary.objects.collection.geometries)
      let communityBoundaries = topojson.mesh(calgary, calgary.objects.collection, function(a, b) {
          return a !== b
      })

      myProjection
          .scale(1)
          .translate([0, 0])
      let b = path.bounds(communities),
              s = .95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height),
              t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2]
      myProjection
          .scale(s)
          .translate(t)

      svg.selectAll('.communities')
          .data(communities.features)
          .enter().append('path')
          .attr('d', path)
          .on('mouseover', (d) => {
            console.log(d3.select(this))
          })
    }
  </script>
</body>
</html>
